language: scala
sudo: false
dist: trusty

# We do not want to start a travis build
# for modifications to any branch.
branches:
    except:
        - develop
    only:
        - master
        - citest

addons:
  apt:
    packages:
#    - openjdk-8-jdk-headless
    - apt-transport-https
    - wget
    - git
    - openssh-server
    - tree
    - python2.7
    - python-pip
    - maven

before_install:
  - mkdir -p /tmp/ci_tests
  - cd /tmp/ci_tests

install:
  # Clone and make the python and java dxpy version
  - pwd
  - git clone https://github.com/dnanexus/dx-toolkit.git
  - make -C dx-toolkit python java

  # Clone dxWDL into a new directory,
  - pwd
  - git clone https://github.com/dnanexus-rnd/dxWDL.git
  - echo "dxWDL branch = $TRAVIS_BRANCH"
  - cd dxWDL && git checkout $TRAVIS_BRANCH && cd ..
  - ls -R dxWDL
  - mkdir -p dxWDL/lib
  - cp dx-toolkit/lib/java/dnanexus-api-0.1.0-SNAPSHOT-jar-with-dependencies.jar dxWDL/lib/

before_script:
  - cd /tmp/ci_tests

script:
  - pwd
  - source dx-toolkit/environment
  - dx login --token ${DX_AUTH_TOKEN} --noprojects
  - dx select dxWDL_playground
  - java -version
  - cd dxWDL && sbt version && ./run_tests.py --test trivial

  # Test on Sydney region
#  - dx select dxWDL_Sydney
#  - dxWDL_jar=`find . -name "dxWDL*.jar"`
#  - echo $dxWDL_jar
#  - java -jar $dxWDL_jar compile test/trivial.wdl --destination '/Swiss Cheese' --force

env:
  global:
    # DX_AUTH_TOKEN (orodeh)
    secure: urtnFBHKJdGWBiI73EVlsm0Gn5N0mHx5AQXtnCOLIQl2yZRHg+/3y+wH5ow0JM55f7pRtlUN4JYRxwXQjsris7jl8qJwYpe1ThJyeiUzNAAEZhPUPjK6o1b5CNae6D9ibdsJywpDw/EQ6cey+iiWn0dvyXfPL9e7DPcaERwESyuNOL3r+lM3l2YpuIT+lxG2mDoH/D324Le+44eYORZjkDk8aOnk6rGk8WEHc7BXhw2GMuk5PU/pxtOXstLRwOlv6LBlOu+TzDXhdo+vwxT6wDHUEnkM8/bewYlNr4IcT1UClSkgWco0fv5uzhGtOs7xqTYhNWMnHsrwrQXBpi9Q1bj5TD0FLgcVeGKgqNQIpsYYwECZoZSHbb9Uz69a5Zotw6BoK6V1lvE/0wGJctWkFZtRyUbvoDap9wQkMYakpw6Hs2uwNyXGGirLlE2yT2anoWe4QfstvqjhAgewzTGKNqYMjvFrT2Faq8agPXGQxKjMVCrzQXLqqXmsoTTKKbUmd69yqYU6geLwIoKezj7rvrwtzntgxLEvQBtfrjhzn5YWt4be+bWzOrRyfcOlKX9W3dZfiH92Kf+RpIwogZD9FHBeR77iUNY0w1QdZ6jO3JorsMqyxT3JWGsWjH1D0IPW4KYILfHWBmfg6WJVTu37qP7S6KPgZlsg4DhFu8oCAO0=